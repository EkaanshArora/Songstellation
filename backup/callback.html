<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Songstellation</title>
  <script src="https://github.com/thenextweb/constellation/releases/download/v1.5.5/constellation.min.js"></script>
  <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
  <meta name="theme-color" content="#101025">
  <meta name="msapplication-navbutton-color" content="#101025">
  <meta name="apple-mobile-web-app-status-bar-style" content="#101025">
  <link rel="stylesheet" href="/callback-style.css">
</head>

<body>
  <canvas id="canvas-layer-0"></canvas>
  <canvas id="canvas-layer-1" width="1000"></canvas>
  <canvas id="canvas-layer-2" width="1000"></canvas>
  <header>
    <h1 id="page-title">
      Spotify Constellation
    </h1>
  </header>
  <main>
    <div>
      <canvas id="can" width="1000">
      </canvas>
    </div>
    <script>
      var w = document.documentElement.clientWidth;
      var h = document.documentElement.clientHeight;
      var c = document.getElementById("canvas-layer-0");
      let starCoord;
      c.height = h;
      c.width = w;
      var ctx = c.getContext("2d");
      var grd = ctx.createLinearGradient(0, 0, w, h);
      grd.addColorStop(0, "#020715");
      grd.addColorStop(1, "#101025");
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, w, h);

      var songTitles = [];
        {{#each message}}
          songTitles.push("{{this}}");
        {{/each}}
      
      var isMobile = {
        Android: function() {
          return navigator.userAgent.match(/Android/i);
        },
        BlackBerry: function() {
          return navigator.userAgent.match(/BlackBerry/i);
        },
        iOS: function() {
          return navigator.userAgent.match(/iPhone|iPad|iPod/i);
        },
        Opera: function() {
          return navigator.userAgent.match(/Opera Mini/i);
        },
        Windows: function() {
          return navigator.userAgent.match(/IEMobile/i);
        },
        any: function() {
          return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
        }
      };
          
      var fontSize="20px",
      starSizeAfterCheck1=1,
      starSizeAfterCheck2=2,
      starSizeAfterCheck3=3,
      lineSizeAfterCheck=1,
      speedAfterCheck=0.06;
          
      if(isMobile.any())
      {
        fontSize="35px";
        starSizeAfterCheck1=2.5;
        starSizeAfterCheck2=1.5;
        starSizeAfterCheck3=7;
        lineSizeAfterCheck=3;
        document.getElementById("page-title").style.fontSize = "4em";
        document.getElementById("page-title").style.marginTop = "2em";
        speedAfterCheck=0.3;
      }
          
      function writeText(x, y, text, ctx) {
        ctx.font = fontSize+" sans-serif";
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.shadowBlur = 0;
        ctx.fillText(text, x, y + 20);
      }

      var constellationInstance1 = window.constellation({
        size: [w, h],
        canvas: document.getElementById('canvas-layer-1'),
        padding: [-50, -50],
        starCount: 200,
        lineCount: 0,
        fuzziness: 10,
        speed: {
          active: speedAfterCheck,
          passive: speedAfterCheck
        },
        style: {
          starColor: '#fff',
          lineColor: 'rgba(255,255,255,.5)',
          lineSize: 1,
          starPadding: 0,
          starSize: starSizeAfterCheck1
        },
        afterStar: (ctx, style, star) => {
          ctx.shadowBlur = 7;
          ctx.shadowColor = "white";
        }
      });

      var constellationInstance2 = window.constellation({
        size: [w, h],
        canvas: document.getElementById('canvas-layer-2'),
        padding: [-50, -50],
        starCount: 150,
        lineCount: 0,
        fuzziness: 10,
        speed: {
          active: speedAfterCheck,
          passive: speedAfterCheck
        },
        style: {
          starColor: '#fff',
          lineColor: 'rgba(255,255,255,.5)',
          lineSize: 1,
          starPadding: 0,
          starSize: starSizeAfterCheck2
        },
        afterStar: (ctx, style, star) => {
          ctx.shadowBlur = 15;
          ctx.shadowColor = "white";
        }
      });
      
      var canvas = document.getElementById('can');
      var aspectRatio = 0.5;
      canvas.height = canvas.width * aspectRatio;
      var constellationInstance = window.constellation({
        size: [w, h],
        canvas: document.getElementById('can'),
        padding: [100, 100],
        starCount: 10,
        lineCount: 15,
        fuzziness: 10,
        speed: {
          active: speedAfterCheck,
          passive: speedAfterCheck
        },
        style: {
          starColor: '#fff',
          lineColor: 'rgba(255,255,255,.5)',
          lineSize: lineSizeAfterCheck,
          starPadding: 0,
          starSize: starSizeAfterCheck3
        },
        onDraw: {
          afterFrame: (ctx, style, objects) => {
            starCoord = [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]];
            starCoordTemp = [];
            for (var i = 0; i < 10; i++) {
              writeText(objects.stars[i].pos[0], objects.stars[i].pos[1], songTitles[i], ctx);
              starCoordTemp.push(objects.stars[i].pos);
            }
            delete starCoord;
            starCoord = Array.from(starCoordTemp);
          },
          afterStar: (ctx, style, star) => {
            ctx.shadowBlur = 30;
            ctx.shadowColor = "white";
          }
        }
      });
          
      constellationInstance.then(() => {
        document.getElementById("can").style.width = "80vw";
        document.getElementById("can").style.height = "80vh"//"100vh"+"-"+canvas.offsetTop;
      });
          
      (function () {
          'use strict';
          var cc = document.getElementById('canvas-layer-2');
          var context = c.getContext('2d');
          var elements = [];
          cc.addEventListener('click', function (e) {
            var x = e.pageX - canvas.offsetLeft;
            var y = e.pageY - canvas.offsetTop;
            console.log(x+" "+y);
            starCoord.forEach(function (element, index) {
              if (Math.pow(x - element[0], 2) + Math.pow(y - element[1], 2) < Math.pow(50, 2))
              {
                alert(index);
              }
            });
          });
      })();
    </script>
    <div id="footer">
    Made by <a href="http://ekaansharora.github.io">Ekaansh Arora</a>
  </div>
  </main>
</body>

</html>